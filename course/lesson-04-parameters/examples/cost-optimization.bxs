// cost-optimization.bxs
/**
 * Cost Optimization with Parameters
 * Reduce costs using smart parameter settings
 */

import bxModules.bxai.models.util.TokenCounter;

println( "=== Cost Optimization Demo ===" )
println()

// Scenario: Generate product descriptions
products = [
    "Wireless Bluetooth Headphones",
    "Smart Home Security Camera",
    "Portable Power Bank"
]

println( "Task: Generate product descriptions for #products.len()# products" )
println()

// Approach 1: No limits (expensive)
println( "Approach 1: No token limits" )
println( "-".repeat( 70 ) )

totalTokens1 = 0
totalCost1 = 0

products.each( product => {
    prompt = "Write a detailed product description for: #product#"

    answer = aiChat( prompt, { temperature: 0.7 } )

    tokens = TokenCounter::count( prompt ) + TokenCounter::count( answer )
    cost = tokens / 1000000 * 0.002

    totalTokens1 += tokens
    totalCost1 += cost

    println( "#product#: #tokens# tokens, $#numberFormat( cost, '0.000000' )#" )
} )

println( "Total: #totalTokens1# tokens, $#numberFormat( totalCost1, '0.000000' )#" )
println()

// Approach 2: With limits (optimized)
println( "Approach 2: With token limits" )
println( "-".repeat( 70 ) )

totalTokens2 = 0
totalCost2 = 0

products.each( product => {
    prompt = "Write a concise product description for: #product#"

    answer = aiChat(
        prompt,
        {
            temperature: 0.7,
            max_tokens: 100  // Limit response length
        }
    )

    tokens = TokenCounter::count( prompt ) + TokenCounter::count( answer )
    cost = tokens / 1000000 * 0.002

    totalTokens2 += tokens
    totalCost2 += cost

    println( "#product#: #tokens# tokens, $#numberFormat( cost, '0.000000' )#" )
} )

println( "Total: #totalTokens2# tokens, $#numberFormat( totalCost2, '0.000000' )#" )
println()

// Comparison
println( "=== Cost Comparison ===" )
println( "Approach 1 (no limits): #totalTokens1# tokens, $#numberFormat( totalCost1, '0.000000' )#" )
println( "Approach 2 (optimized): #totalTokens2# tokens, $#numberFormat( totalCost2, '0.000000' )#" )
println( "Savings: #numberFormat( (1 - totalCost2/totalCost1) * 100, '0.0' )#%" )
println()

println( "ðŸ’¡ Cost Optimization Tips:" )
println( "1. Always set max_tokens for predictable costs" )
println( "2. Use clear, concise prompts" )
println( "3. Lower temperature for factual content (0.1-0.3)" )
println( "4. Use cheaper models for simple tasks (gpt-3.5-turbo)" )
println( "5. Cache frequent responses" )
println( "6. Use Ollama for development (FREE)" )
