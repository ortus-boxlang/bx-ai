/**
 * Summary Memory Example
 * Demonstrates intelligent conversation compression
 * 
 * Run with: boxlang summary-memory.bxs
 */

println( "=== Summary Memory Demo ===" )
println()

// Create summary memory with explicit configuration
memory = aiMemory( "summary", {
    maxMessages: 12,           // Trigger summary after 12 messages
    summaryThreshold: 6,       // Keep last 6 messages uncompressed
    summaryModel: "gpt-4o-mini",
    summaryProvider: "openai"
} )

memory.add( aiMessage().system( "You are a helpful customer support agent" ) )

println( "Config: Max 12 messages, keep last 6 uncompressed" )
println( "Memory type: Summary (intelligent compression)" )
println()

// Have a longer conversation
topics = [
    { q: "What is a variable?", a: "A variable is a named storage location..." },
    { q: "What is a function?", a: "A function is a reusable block of code..." },
    { q: "What is an array?", a: "An array is an ordered collection..." },
    { q: "What is a loop?", a: "A loop repeats code multiple times..." },
    { q: "What is an object?", a: "An object groups data and behavior..." }
]

topics.each( ( topic, index ) => {
    println( "Turn #index + 1#:" )
    println( "  You: #topic.q#" )

    memory.add( aiMessage().user( topic.q ) )
    memory.add( aiMessage().assistant( topic.a ) )

    println( "  AI: #topic.a.left( 50 )#..." )
    println( "  Memory: #memory.count()# messages" )
    println()
} )

// Test if AI remembers early topics
println( "Testing memory of early topics:" )
println( "You: What did we discuss first?" )

memory.add( aiMessage().user( "What did we discuss first?" ) )
response = aiChat( memory.getAll() )

println( "AI: #response#" )
println()

println( "ðŸ’¡ Summary Memory:" )
println( "- Summarizes older messages" )
println( "- Preserves important context" )
println( "- Good for: long conversations" )
println( "- Better context retention than windowed" )
