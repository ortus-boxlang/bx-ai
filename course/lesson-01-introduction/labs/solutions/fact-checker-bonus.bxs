// fact-checker-bonus.bxs
/**
 * BONUS SOLUTION: Advanced Fact Checker
 * 
 * This solution implements all bonus challenges:
 * - Confidence scoring
 * - Multiple statements
 * - File output
 * - Model comparison
 */

import bxModules.bxai.models.util.TokenCounter;

println( "=== Advanced AI Fact Checker ===" )
println()

// Multiple statements to check
statements = [
    "The Earth orbits around the Sun",
    "The Great Wall of China is visible from space",
    "Humans only use 10% of their brain",
    "Lightning never strikes the same place twice"
]

// Models to compare
models = [ "gpt-3.5-turbo", "gpt-4-turbo" ]

// Store all results
allResults = []

// Check each statement with each model
statements.each( ( statement ) => {
    println( "Checking: '#statement#'" )
    
    statementResults = {
        statement: statement,
        checks: []
    }
    
    models.each( ( model ) => {
        try {
            prompt = "
You are a fact-checker. Analyze this statement and respond ONLY in this format:

VERDICT: [TRUE/FALSE/UNCERTAIN]
CONFIDENCE: [0-100]
EXPLANATION: [Brief explanation]

Statement: #statement#
"
            
            // Track timing
            startTime = getTickCount()
            
            // Call AI with specific model
            response = aiChat(
                prompt,
                { model: model, temperature: 0.1 }
            )
            
            elapsed = getTickCount() - startTime
            
            // Count tokens
            inputTokens = TokenCounter::count( prompt )
            outputTokens = TokenCounter::count( response )
            
            // Store result
            statementResults.checks.append( {
                model: model,
                response: response,
                elapsed: elapsed,
                inputTokens: inputTokens,
                outputTokens: outputTokens
            } )
            
            println( "  ✓ #model# completed in #elapsed#ms" )
            
        } catch( any e ) {
            println( "  ✗ #model# failed: #e.message#" )
        }
    } )
    
    allResults.append( statementResults )
    println()
} )

// Display all results
println( "=== FACT CHECK RESULTS ===" )
println()

allResults.each( ( result ) => {
    println( "Statement: #result.statement#" )
    println( "-".repeat( 80 ) )
    
    result.checks.each( ( check ) => {
        println()
        println( "Model: #check.model#" )
        println( check.response )
        println()
        println( "Stats: #check.inputTokens# input + #check.outputTokens# output = #check.inputTokens + check.outputTokens# tokens (#check.elapsed#ms)" )
    } )
    
    println()
    println()
} )

// Save to file (optional)
try {
    // Format as JSON
    jsonResults = serializeJSON( allResults, true )
    
    // Save to file
    fileWrite( "fact-check-results.json", jsonResults )
    
    println( "✅ Results saved to: fact-check-results.json" )
} catch( any e ) {
    println( "⚠️  Could not save results: #e.message#" )
}

println()
println( "=== Complete ===" )
