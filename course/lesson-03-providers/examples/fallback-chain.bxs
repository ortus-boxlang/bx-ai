// fallback-chain.bxs
/**
 * Fallback Chain Pattern
 * Automatically try multiple providers if one fails
 */

println( "=== Fallback Chain Demo ===" )
println( "Trying providers in order until one succeeds" )
println()

/**
 * Smart AI chat with automatic fallback
 */
function aiChatWithFallback( prompt, options = {} ) {
    // Define fallback chain
    providerChain = [
        { provider: "openai", model: "gpt-3.5-turbo" },
        { provider: "claude", model: "claude-3-haiku-20240307" },
        { provider: "gemini", model: "gemini-pro" },
        { provider: "ollama", model: "llama3.2" }
    ]

    // Try each provider
    for ( config in providerChain ) {
        try {
            println( "Trying #config.provider# (#config.model#)..." )

            answer = aiChat(
                prompt,
                { model: config.model },
                { provider: config.provider }
            )

            println( "‚úÖ Success with #config.provider#!" )
            return answer

        } catch( any e ) {
            println( "‚ùå #config.provider# failed: #e.message#" )
            println( "   Moving to next provider..." )
        }
    }

    throw( "All providers in fallback chain failed" )
}

// Test the fallback chain
try {
    prompt = "What is the capital of France?"

    println( "Prompt: '#prompt#'" )
    println()

    answer = aiChatWithFallback( prompt )

    println()
    println( "Final answer: #answer#" )

} catch( any e ) {
    println()
    println( "‚ùå Complete failure: #e.message#" )
}

println()
println( "üí° Fallback Chain Pattern:" )
println( "- Increases reliability" )
println( "- Handles provider outages" )
println( "- Automatically uses available providers" )
println( "- Can prioritize by cost or capability" )
